<?phperror_reporting(E_ALL);ini_set('display_errors', TRUE);ini_set('display_startup_errors', TRUE);define('EOL',(PHP_SAPI == 'cli') ? PHP_EOL : '<br />');date_default_timezone_set('Asia/Jakarta');use \PHPExcel_IOFactory;use \yii\db\Command;$objReader = PHPExcel_IOFactory::createReader('Excel5');$objPHPExcel = $objReader->load("./files/Template Invoice.xls");$objPHPExcel->setActiveSheetIndex(0);$arraydata = '';for($i = 0; $i < count($idinv); $i++) {            $id = $idinv[$i];            $arraydata .= $id.",";			}$arraydata = substr($arraydata,0,-1);$explodearray = explode(',',$arraydata);foreach($explodearray as $index => $values){    $getBilling = Yii::$app->db->createCommand("        select mc.CustomerName as CusName,* from BillingH bh        left join MasterCustomer mc on mc.CustomerID = bh.CustomerID        where bh.InvoiceNo ='".$explodearray[$index]."'")->queryAll();        $Date = $getBilling[$index]['InvoiceDate'];    $TOPDate = date('j M Y', strtotime($Date. ' + 14 days'));        $clonedSheet[$index] = clone $objPHPExcel->getActiveSheet();    $clonedSheet[$index]->setTitle($getBilling[$index]['InvoiceNo']);        //Customer    $clonedSheet[$index]->setCellValue('A6', $getBilling[$index]['CusName']);    $clonedSheet[$index]->setCellValue('A8', $getBilling[$index]['Address']);        //Invoice    $clonedSheet[$index]->setCellValue('I4', $getBilling[$index]['InvoiceNo']);    $clonedSheet[$index]->setCellValue('I6', $TOPDate);        //Keterangan    $clonedSheet[$index]->setCellValue('A9','Total DPP  PERIODE DESEMBER 2015');        //Jumlah    $clonedSheet[$index]->setCellValue('I9',$getBilling[$index]['TotalDPP']);    $clonedSheet[$index]->setCellValue('I11',$getBilling[$index]['TotalMFee']);    $clonedSheet[$index]->setCellValue('I12',$getBilling[$index]['TotalPPN']);        //Total    $clonedSheet[$index]->setCellValue('I16',$getBilling[$index]['TotalInvoice']);        $terbilang = Yii::$app->db->createCommand("select dbo.fnEPKonversiBilanganDecimal(".round($getBilling[$index]['TotalInvoice'], 0, PHP_ROUND_HALF_EVEN).")")->queryScalar();        //Terbilang    $clonedSheet[$index]->setCellValue('B18',$terbilang);        $InvDate = date('j M Y', strtotime($Date));        //Tanggal Cetak    $clonedSheet[$index]->setCellValue('I20','Jakarta,'.$InvDate);        // Add sheet to excel    $objPHPExcel->addSheet($clonedSheet[$index]);}$objPHPExcel->removeSheetByIndex(0);header('Content-Type: application/vnd.ms-excel');header('Content-Disposition: attachment;filename="InvoiceBilling.xls"');header('Cache-Control: max-age=0');ob_end_clean();$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');$objWriter->save("php://output");